# MobileCLIP-S1 Fine-tuning on SAV Text Annotations
# Pretrained on recap_datacomp, fine-tuned on sa-v-text + rf20-vl text annotations

MODEL:
  NAME: EfficientSAM3_Text_M_SAV
  BACKBONE: MobileCLIP-S1
  PRETRAINED: output/efficient_sam3_mobileclip_s1_1p.pth  # Load weights from recap_datacomp
  RESUME: ''  # Not resuming - fine-tuning from epoch 0

TRAIN:
  START_EPOCH: 0
  EPOCHS: 60  # Longer fine-tuning
  WARMUP_EPOCHS: 3
  WEIGHT_DECAY: 0.01  # Lower for fine-tuning
  BASE_LR: 1e-5  # Lower LR for fine-tuning
  WARMUP_LR: 1e-7
  MIN_LR: 1e-8  # Anneal to very low LR at the end
  CLIP_GRAD: 1.0
  AUTO_RESUME: True
  ACCUMULATION_STEPS: 2
  USE_CHECKPOINT: False
  LAYER_LR_DECAY: 0.95  # More aggressive layer decay for fine-tuning
  EVAL_BN_WHEN_TRAINING: False
  FIND_UNUSED_PARAMETERS: True

  LR_SCHEDULER:
    NAME: 'cosine'
    DECAY_EPOCHS: 60
    DECAY_RATE: 0.1

  OPTIMIZER:
    NAME: 'adamw'
    EPS: 1e-8
    BETAS: (0.9, 0.999)
    MOMENTUM: 0.9

AMP_ENABLE: True
OUTPUT: output/stage1_text_sav/mobileclip_s1
TAG: sav_finetune
SAVE_FREQ: 1
PRINT_FREQ: 10
SEED: 0
EVAL_MODE: False
THROUGHPUT_MODE: False
LOCAL_RANK: 0

DATA:
  IMG_SIZE: 1008
  DATASET: text_annotations
  DATA_PATH: data/
  BATCH_SIZE: 64
  NUM_WORKERS: 8

DISTILL:
  ENABLED: True
  ENCODER_ONLY: True
  EMBED_DIM: 256
  EMBED_SIZE: 0
  NUM_EMBED: 32
  PIXEL_WISE: 1.0
  CHANNEL_WISE: 0.0
  CORRELATION: 0.0
  COSINE: 1.5
  TEACHER_EMBED_PATH: output/stage1_text_teacher_sav/embeddings/
